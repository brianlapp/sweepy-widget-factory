<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweepstakes Widget</title>
</head>
<body>
    <div id="root"></div>
    <script>
        // Enhanced error tracking
        window.onerror = function(msg, url, line, col, error) {
            console.error('[Widget Error]', { msg, url, line, col, error });
            window.parent.postMessage({ 
                type: 'WIDGET_ERROR', 
                error: { message: msg, url, line, stack: error?.stack } 
            }, '*');
            return false;
        };

        // Detailed initialization logging
        console.log('[Widget] Starting initialization...');
        
        // Track React availability
        window.__REACT_STATUS__ = {
            loaded: false,
            error: null
        };

        // Enhanced load event handling
        window.addEventListener('load', function() {
            console.log('[Widget] Window loaded, checking React status:', window.__REACT_STATUS__);
            window.parent.postMessage({ 
                type: 'WIDGET_LOADED',
                status: window.__REACT_STATUS__
            }, '*');
        });

        // Track React initialization
        window.__WIDGET_READY__ = false;
        window.__initializeWidget = function(sweepstakesId) {
            console.log('[Widget] Initializing with ID:', sweepstakesId);
            try {
                window.initializeWidget(sweepstakesId);
                window.__WIDGET_READY__ = true;
                console.log('[Widget] Successfully initialized');
                window.parent.postMessage({ type: 'WIDGET_READY' }, '*');
            } catch (error) {
                console.error('[Widget] Initialization failed:', error);
                window.parent.postMessage({ 
                    type: 'WIDGET_ERROR', 
                    error: { 
                        message: 'Initialization failed', 
                        details: error?.message,
                        stack: error?.stack
                    } 
                }, '*');
            }
        };
    </script>
    <script src="widget.js"></script>
</body>
</html>